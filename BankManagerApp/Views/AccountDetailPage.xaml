<?xml version="1.0" encoding="utf-8" ?>
<ContentPage xmlns="http://schemas.microsoft.com/dotnet/2021/maui"
             xmlns:x="http://schemas.microsoft.com/winfx/2009/xaml"
             xmlns:viewmodels="clr-namespace:BankManagerApp.ViewModels"
             xmlns:models="clr-namespace:BankManagerApp.Models"
             x:Class="BankManagerApp.Views.AccountDetailPage"
             Title="Ø¬Ø²Ø¦ÛŒØ§Øª Ø­Ø³Ø§Ø¨"
             FlowDirection="RightToLeft">

    <ContentPage.BindingContext>
        <viewmodels:AccountDetailViewModel />
    </ContentPage.BindingContext>

    <ScrollView>
        <VerticalStackLayout Padding="20" Spacing="20">
            
            <!-- Account Info Card -->
            <Frame Padding="25" 
                   CornerRadius="20" 
                   BackgroundColor="{StaticResource Primary}"
                   HasShadow="True">
                <VerticalStackLayout Spacing="10">
                    <Label Text="{Binding Account.Name}"
                           FontSize="26"
                           FontAttributes="Bold"
                           TextColor="White"
                           HorizontalOptions="Center"/>
                    
                    <Label Text="{Binding Account.Id, StringFormat='Ø´Ù†Ø§Ø³Ù‡ Ø­Ø³Ø§Ø¨: {0}'}"
                           FontSize="14"
                           TextColor="White"
                           Opacity="0.9"
                           HorizontalOptions="Center"/>
                    
                    <BoxView HeightRequest="1" 
                             Color="White" 
                             Opacity="0.3"
                             Margin="0,10"/>
                    
                    <Label Text="Ù…ÙˆØ¬ÙˆØ¯ÛŒ ÙØ¹Ù„ÛŒ"
                           FontSize="14"
                           TextColor="White"
                           Opacity="0.9"
                           HorizontalOptions="Center"/>
                    
                    <Label Text="{Binding Account.BalanceText}"
                           FontSize="36"
                           FontAttributes="Bold"
                           TextColor="White"
                           HorizontalOptions="Center"/>
                </VerticalStackLayout>
            </Frame>

            <!-- Transaction Form Card -->
            <Frame Padding="20" 
                   CornerRadius="15" 
                   BackgroundColor="{StaticResource White}"
                   HasShadow="True">
                <VerticalStackLayout Spacing="15">
                    <Label Text="ðŸ’¸ Ø§Ù†Ø¬Ø§Ù… ØªØ±Ø§Ú©Ù†Ø´"
                           FontSize="20"
                           FontAttributes="Bold"
                           TextColor="{StaticResource Primary}"/>
                    
                    <Entry Placeholder="Ù…Ø¨Ù„Øº (ØªÙˆÙ…Ø§Ù†)"
                           Text="{Binding Amount}"
                           Keyboard="Numeric"
                           FontSize="18"
                           PlaceholderColor="{StaticResource Gray400}"
                           TextColor="{StaticResource Gray900}"/>
                    
                    <Grid ColumnDefinitions="*,*" ColumnSpacing="10">
                        <Button Grid.Column="0"
                                Text="ðŸ’° ÙˆØ§Ø±ÛŒØ²"
                                Command="{Binding DepositCommand}"
                                BackgroundColor="#4CAF50"
                                TextColor="White"
                                FontSize="16"
                                FontAttributes="Bold"
                                Padding="12"
                                CornerRadius="10"/>
                        
                        <Button Grid.Column="1"
                                Text="ðŸ’µ Ø¨Ø±Ø¯Ø§Ø´Øª"
                                Command="{Binding WithdrawCommand}"
                                BackgroundColor="#FF5722"
                                TextColor="White"
                                FontSize="16"
                                FontAttributes="Bold"
                                Padding="12"
                                CornerRadius="10"/>
                    </Grid>
                    
                    <!-- Status Message -->
                    <Label Text="{Binding StatusMessage}"
                           FontSize="14"
                           HorizontalOptions="Center"
                           IsVisible="{Binding StatusMessage, Converter={StaticResource StringNotEmptyConverter}}"
                           Margin="0,5,0,0"/>
                </VerticalStackLayout>
            </Frame>

            <!-- Transaction History -->
            <Frame Padding="20" 
                   CornerRadius="15" 
                   BackgroundColor="{StaticResource White}"
                   HasShadow="True">
                <VerticalStackLayout Spacing="15">
                    <Label Text="ðŸ“‹ ØªØ§Ø±ÛŒØ®Ú†Ù‡ ØªØ±Ø§Ú©Ù†Ø´â€ŒÙ‡Ø§"
                           FontSize="20"
                           FontAttributes="Bold"
                           TextColor="{StaticResource Primary}"/>
                    
                    <CollectionView ItemsSource="{Binding Account.Transactions}">
                        <CollectionView.EmptyView>
                            <Label Text="Ù‡Ù†ÙˆØ² ØªØ±Ø§Ú©Ù†Ø´ÛŒ Ø§Ù†Ø¬Ø§Ù… Ù†Ø´Ø¯Ù‡ Ø§Ø³Øª"
                                   FontSize="14"
                                   TextColor="{StaticResource Gray500}"
                                   HorizontalOptions="Center"
                                   Margin="0,20"/>
                        </CollectionView.EmptyView>
                        
                        <CollectionView.ItemTemplate>
                            <DataTemplate x:DataType="models:Transaction">
                                <Frame Padding="15" 
                                       Margin="0,0,0,10"
                                       CornerRadius="10"
                                       BackgroundColor="{StaticResource Gray100}"
                                       HasShadow="False">
                                    <Grid ColumnDefinitions="*,Auto" RowDefinitions="Auto,Auto">
                                        <Label Grid.Row="0" Grid.Column="0"
                                               Text="{Binding TypeText}"
                                               FontSize="16"
                                               FontAttributes="Bold"
                                               TextColor="{StaticResource Gray900}"/>
                                        
                                        <Label Grid.Row="0" Grid.Column="1"
                                               Text="{Binding AmountText}"
                                               FontSize="16"
                                               FontAttributes="Bold"
                                               TextColor="{Binding Type, Converter={StaticResource TransactionColorConverter}}"/>
                                        
                                        <Label Grid.Row="1" Grid.Column="0" Grid.ColumnSpan="2"
                                               Text="{Binding DateTimeText}"
                                               FontSize="12"
                                               TextColor="{StaticResource Gray600}"
                                               Margin="0,5,0,0"/>
                                    </Grid>
                                </Frame>
                            </DataTemplate>
                        </CollectionView.ItemTemplate>
                    </CollectionView>
                </VerticalStackLayout>
            </Frame>
        </VerticalStackLayout>
    </ScrollView>
</ContentPage>
