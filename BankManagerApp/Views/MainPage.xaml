<?xml version="1.0" encoding="utf-8" ?>
<ContentPage xmlns="http://schemas.microsoft.com/dotnet/2021/maui"
             xmlns:x="http://schemas.microsoft.com/winfx/2009/xaml"
             xmlns:viewmodels="clr-namespace:BankManagerApp.ViewModels"
             xmlns:models="clr-namespace:BankManagerApp.Models"
             x:Class="BankManagerApp.Views.MainPage"
             Title="Ù…Ø¯ÛŒØ±ÛŒØª Ø­Ø³Ø§Ø¨â€ŒÙ‡Ø§ÛŒ Ø¨Ø§Ù†Ú©ÛŒ"
             FlowDirection="RightToLeft">

    <ContentPage.BindingContext>
        <viewmodels:MainViewModel />
    </ContentPage.BindingContext>

    <Grid RowDefinitions="Auto,*,Auto" Padding="20">
        
        <!-- Header -->
        <VerticalStackLayout Grid.Row="0" Spacing="10" Margin="0,0,0,20">
            <Label Text="ðŸ’° Ù…Ø¯ÛŒØ±ÛŒØª Ø­Ø³Ø§Ø¨â€ŒÙ‡Ø§ÛŒ Ø¨Ø§Ù†Ú©ÛŒ" 
                   FontSize="28" 
                   FontAttributes="Bold"
                   HorizontalOptions="Center"
                   TextColor="{StaticResource Primary}"/>
            <Label Text="Ø­Ø³Ø§Ø¨â€ŒÙ‡Ø§ÛŒ Ø´Ù…Ø§" 
                   FontSize="18" 
                   FontAttributes="Bold"
                   Margin="0,10,0,0"/>
        </VerticalStackLayout>

        <!-- Accounts List -->
        <ScrollView Grid.Row="1">
            <CollectionView ItemsSource="{Binding Accounts}"
                          SelectionMode="None">
                <CollectionView.EmptyView>
                    <VerticalStackLayout HorizontalOptions="Center" 
                                       VerticalOptions="Center"
                                       Spacing="15">
                        <Label Text="ðŸ“­" 
                               FontSize="60"
                               HorizontalOptions="Center"/>
                        <Label Text="Ù‡Ù†ÙˆØ² Ø­Ø³Ø§Ø¨ÛŒ Ø§ÛŒØ¬Ø§Ø¯ Ù†Ø´Ø¯Ù‡ Ø§Ø³Øª" 
                               FontSize="16"
                               TextColor="{StaticResource Gray600}"
                               HorizontalOptions="Center"/>
                        <Label Text="Ø±ÙˆÛŒ Ø¯Ú©Ù…Ù‡ Ø²ÛŒØ± Ú©Ù„ÛŒÚ© Ú©Ù†ÛŒØ¯ ØªØ§ Ø­Ø³Ø§Ø¨ Ø¬Ø¯ÛŒØ¯ Ø¨Ø³Ø§Ø²ÛŒØ¯" 
                               FontSize="14"
                               TextColor="{StaticResource Gray500}"
                               HorizontalOptions="Center"/>
                    </VerticalStackLayout>
                </CollectionView.EmptyView>
                
                <CollectionView.ItemTemplate>
                    <DataTemplate x:DataType="models:BankAccount">
                        <Frame Margin="0,0,0,15" 
                               Padding="20"
                               CornerRadius="15"
                               HasShadow="True"
                               BackgroundColor="{StaticResource White}">
                            <Frame.GestureRecognizers>
                                <TapGestureRecognizer 
                                    Command="{Binding Source={RelativeSource AncestorType={x:Type viewmodels:MainViewModel}}, Path=SelectAccountCommand}"
                                    CommandParameter="{Binding .}"/>
                            </Frame.GestureRecognizers>
                            
                            <Grid ColumnDefinitions="*,Auto" RowDefinitions="Auto,Auto,Auto">
                                <!-- Account Icon -->
                                <Label Grid.Row="0" Grid.Column="1" Grid.RowSpan="3"
                                       Text="ðŸ’³"
                                       FontSize="50"
                                       VerticalOptions="Center"
                                       Margin="0,0,15,0"/>
                                
                                <!-- Account Name -->
                                <Label Grid.Row="0" Grid.Column="0"
                                       Text="{Binding Name}"
                                       FontSize="20"
                                       FontAttributes="Bold"
                                       TextColor="{StaticResource Primary}"/>
                                
                                <!-- Account ID -->
                                <Label Grid.Row="1" Grid.Column="0"
                                       Text="{Binding Id, StringFormat='Ø´Ù†Ø§Ø³Ù‡: {0}'}"
                                       FontSize="14"
                                       TextColor="{StaticResource Gray600}"
                                       Margin="0,5,0,0"/>
                                
                                <!-- Balance -->
                                <Label Grid.Row="2" Grid.Column="0"
                                       Text="{Binding BalanceText}"
                                       FontSize="24"
                                       FontAttributes="Bold"
                                       TextColor="{StaticResource Secondary}"
                                       Margin="0,10,0,0"/>
                            </Grid>
                        </Frame>
                    </DataTemplate>
                </CollectionView.ItemTemplate>
            </CollectionView>
        </ScrollView>

        <!-- Create Account Button -->
        <Button Grid.Row="2"
                Text="âž• Ø§ÛŒØ¬Ø§Ø¯ Ø­Ø³Ø§Ø¨ Ø¬Ø¯ÛŒØ¯"
                Command="{Binding CreateAccountCommand}"
                FontSize="18"
                FontAttributes="Bold"
                Padding="15"
                CornerRadius="15"
                BackgroundColor="{StaticResource Primary}"
                TextColor="White"
                Margin="0,20,0,0"/>
    </Grid>
</ContentPage>
